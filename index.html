<!doctype html>
<html>

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <title>Pay Your Bill!</title>
        <link rel="stylesheet" href="stylesheets/bootstrap.min.css">
        <link rel="stylesheet" href="stylesheets/styles.css">
        <meta name="viewport" content="width=device-width">
        <script src="javascripts/jquery.min.js"></script>
    </head>

    <body>
        <div class="wrapper">
            <div class="container">
                <div class="card">
                    <div class="card-block">
                        <h4 class="card-title">Bill Summary</h4>
                        <p class="card-text">Account number: 12983773</p>
                        <p class="card-text">Amount due: &euro;370.79</p>
                        <button type="button" id="paybill" class="btn btn-primary">Pay Now!</button>
                    </div>
                </div>
            </div>
        </div>
        <script>
            (function (d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) {
                    return;
                }
                js = d.createElement(s);
                js.id = id;
                js.src = "//connect.facebook.com/en_US/messenger.Extensions.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'Messenger'));

            (function ($) {
                $(document).ready(function () {
                    $('#paybill').click(function () {
                        MessengerExtensions.getUserID(function success(uids) {
                            $.ajax({
                                contentType: 'application/json',
                                data: '{"id": ' + uids.psid + '}',
                                dataType: 'json',
                                success: function (data) {
                                    var close = MessengerExtensions.requestCloseBrowser(function success() {
                                    }, function error(err) {
                                    });
                                    try {
                                        close();
                                    } catch (e) {
                                        
                                    }
                                },
                                error: function () {
                                    console.log("Device control failed");
                                },
                                type: 'POST',
                                url: 'https://fb-esbbot.herokuapp.com/billpayed'
                            });
                        }, function error(err) {

                        });
                    });
                });
            })(jQuery);
        </script>
        <script src="javascripts/scale.fix.js"></script>
    </body>

</html>
